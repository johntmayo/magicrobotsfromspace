<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAGIC ROBOTS FROM SPACE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Xanh+Mono:ital@0;1&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --void: #0a0a0c;
      --signal: #e8ff47;
      --static: #3a3a4a;
      --transmission: #1a1a2e;
      --flirty: #ff2d95;
      --oracle: #e8a84a;
      --scholar: #4ae8e0;
      --poet: #b88aff;
      --guardian: #6ae88a;
      --trickster: #ff8c42;
      --beacon: #fff59e;
      --void-bot: #e0e0e8;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--void);
      color: var(--signal);
      font-family: 'Xanh Mono', monospace;
      cursor: crosshair;
    }

    /* Star field */
    .cosmos {
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 40% 70%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 50% 20%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1.5px 1.5px at 60% 50%, var(--signal), transparent),
        radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.4), transparent),
        radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 10% 90%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1.2px 1.2px at 25% 55%, var(--signal), transparent),
        radial-gradient(1px 1px at 85% 65%, rgba(255,255,255,0.5), transparent);
      background-size: 200% 200%;
      animation: drift 120s linear infinite;
      z-index: 0;
    }

    @keyframes drift {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 200%; }
    }

    /* Scan lines */
    .scanlines {
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.15) 2px,
        rgba(0, 0, 0, 0.15) 4px
      );
      pointer-events: none;
      z-index: 100;
    }

    /* Main container */
    .transmission-zone {
      position: relative;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1;
      padding: 2rem;
    }

    /* Header */
    .origin {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.6rem, 2vw, 0.9rem);
      letter-spacing: 0.5em;
      color: var(--static);
      margin-bottom: 3rem;
      text-transform: uppercase;
    }

    /* Robot glyph */
    .entity {
      font-size: clamp(3rem, 15vw, 8rem);
      line-height: 1;
      margin-bottom: 2rem;
      animation: hover 4s ease-in-out infinite;
      filter: drop-shadow(0 0 30px var(--signal));
      user-select: none;
      transition: transform 0.3s ease;
    }

    .entity:hover {
      transform: scale(1.1) rotate(5deg);
    }

    .entity.flirty {
      color: var(--flirty);
      filter: drop-shadow(0 0 40px var(--flirty)) drop-shadow(0 0 80px var(--flirty));
      animation: hover 4s ease-in-out infinite, flirtyPulse 0.5s ease-in-out infinite, flirtyWiggle 0.3s ease-in-out infinite;
    }

    @keyframes flirtyPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes flirtyWiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }

    .message.flirty {
      color: var(--flirty);
      font-style: italic;
    }

    @keyframes hover {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    /* Message area */
    .signal {
      max-width: 600px;
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .message {
      font-size: clamp(1rem, 3vw, 1.4rem);
      line-height: 1.8;
      letter-spacing: 0.05em;
      opacity: 0;
      animation: fadeIn 2s ease forwards;
    }

    .message::after {
      content: '▋';
      animation: blink 1s step-end infinite;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* Coordinates */
    .coordinates {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.7rem;
      color: var(--static);
      letter-spacing: 0.3em;
      margin-top: 4rem;
    }

    /* Interactive prompt */
    .invoke {
      position: fixed;
      bottom: 3rem;
      font-size: 0.75rem;
      color: var(--static);
      letter-spacing: 0.2em;
      transition: color 0.3s ease;
      cursor: pointer;
    }

    .invoke:hover {
      color: var(--signal);
    }

    /* Glitch effect */
    .glitch {
      animation: glitch 0.3s ease;
    }

    @keyframes glitch {
      0% { transform: translate(0); filter: hue-rotate(0deg); }
      20% { transform: translate(-5px, 3px); filter: hue-rotate(90deg); }
      40% { transform: translate(3px, -2px); filter: hue-rotate(180deg); }
      60% { transform: translate(-2px, 5px); filter: hue-rotate(270deg); }
      80% { transform: translate(4px, -3px); filter: hue-rotate(360deg); }
      100% { transform: translate(0); filter: hue-rotate(0deg); }
    }

    /* Floating particles */
    .particle {
      position: fixed;
      width: 3px;
      height: 3px;
      background: var(--signal);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      z-index: 50;
    }

    /* Signal strength indicator */
    .signal-strength {
      position: fixed;
      top: 2rem;
      right: 2rem;
      display: flex;
      gap: 4px;
      align-items: flex-end;
    }

    .bar {
      width: 4px;
      background: var(--signal);
      opacity: 0.3;
      transition: opacity 0.5s ease;
    }

    .bar:nth-child(1) { height: 8px; }
    .bar:nth-child(2) { height: 14px; }
    .bar:nth-child(3) { height: 20px; }
    .bar:nth-child(4) { height: 26px; }
    .bar:nth-child(5) { height: 32px; }

    .bar.active {
      opacity: 1;
    }

    /* Hidden audio visualizer */
    .frequency {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 3px;
      opacity: 0.15;
    }

    .freq-bar {
      width: 2px;
      background: var(--signal);
      animation: freq 1.5s ease-in-out infinite;
    }

    @keyframes freq {
      0%, 100% { height: 5px; }
      50% { height: var(--h, 30px); }
    }

    /* Audio control */
    .audio-toggle {
      position: fixed;
      top: 2rem;
      left: 2rem;
      font-family: 'Major Mono Display', monospace;
      font-size: 0.65rem;
      color: var(--static);
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: color 0.3s ease;
      z-index: 101;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .audio-toggle:hover {
      color: var(--signal);
    }

    .audio-toggle .icon {
      font-size: 1rem;
      transition: transform 0.3s ease;
    }

    .audio-toggle.active .icon {
      color: var(--signal);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ═══ PORTAL: Robot selection ═══ */
    .portal {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 900px;
      padding: 2rem;
      display: none;
    }

    .portal.visible {
      display: block;
      animation: fadeIn 1s ease forwards;
    }

    .portal-title {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.5rem, 1.5vw, 0.75rem);
      letter-spacing: 0.6em;
      color: var(--static);
      text-align: center;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
    }

    .portal-subtitle {
      font-size: clamp(0.85rem, 2vw, 1.1rem);
      color: var(--signal);
      text-align: center;
      margin-bottom: 2.5rem;
      letter-spacing: 0.1em;
      opacity: 0.9;
    }

    .robot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1.25rem;
      justify-items: center;
    }

    .robot-card {
      width: 100%;
      max-width: 160px;
      aspect-ratio: 0.85;
      background: rgba(26, 26, 46, 0.6);
      border: 1px solid var(--static);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      cursor: pointer;
      transition: border-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
    }

    .robot-card:hover {
      border-color: var(--signal);
      transform: translateY(-4px);
      box-shadow: 0 0 24px rgba(232, 255, 71, 0.15);
    }

    .robot-card .glyph {
      font-size: clamp(2rem, 6vw, 3rem);
      line-height: 1.2;
      margin-bottom: 0.5rem;
      filter: drop-shadow(0 0 12px currentColor);
      transition: transform 0.3s ease;
    }

    .robot-card:hover .glyph {
      transform: scale(1.1);
    }

    .robot-card .name {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }

    .robot-card .tagline {
      font-size: 0.65rem;
      color: var(--static);
      text-align: center;
      line-height: 1.3;
    }

    /* ═══ CONVERSATION view ═══ */
    .conversation {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 640px;
      height: 100%;
      min-height: 70vh;
      display: none;
      flex-direction: column;
      padding: 2rem;
    }

    .conversation.visible {
      display: flex;
      animation: fadeIn 0.8s ease forwards;
    }

    .conversation-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .conversation .entity {
      margin-bottom: 0;
      font-size: clamp(2rem, 8vw, 4rem);
    }

    .conversation-meta {
      flex: 1;
    }

    .conversation-meta .name {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.7rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
    }

    .conversation-meta .status {
      font-size: 0.65rem;
      color: var(--static);
      letter-spacing: 0.15em;
      margin-top: 0.2rem;
    }

    .back-link {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.2em;
      color: var(--static);
      cursor: pointer;
      transition: color 0.3s ease;
      margin-left: auto;
    }

    .back-link:hover {
      color: var(--signal);
    }

    .chat-log {
      flex: 1;
      min-height: 200px;
      max-height: 40vh;
      overflow-y: auto;
      padding: 1rem 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .chat-bubble {
      padding: 0.75rem 1rem;
      border-radius: 4px;
      max-width: 90%;
      font-size: clamp(0.85rem, 2vw, 1rem);
      line-height: 1.6;
      letter-spacing: 0.03em;
      border: 1px solid transparent;
    }

    .chat-bubble.robot {
      align-self: flex-start;
      background: rgba(26, 26, 46, 0.8);
      border-color: var(--static);
    }

    .chat-bubble.user {
      align-self: flex-end;
      background: rgba(58, 58, 74, 0.5);
      color: var(--signal);
    }

    .chat-input-row {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      background: var(--transmission);
      border: 1px solid var(--static);
      color: var(--signal);
      font-family: 'Xanh Mono', monospace;
      font-size: 0.95rem;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      letter-spacing: 0.05em;
      transition: border-color 0.3s ease;
    }

    .chat-input::placeholder {
      color: var(--static);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--signal);
    }

    .send-btn {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      padding: 0.75rem 1rem;
      background: transparent;
      border: 1px solid var(--signal);
      color: var(--signal);
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .send-btn:hover {
      background: var(--signal);
      color: var(--void);
    }

    .transmission-zone.conversation-mode {
      justify-content: flex-start;
    }
  </style>
</head>
<body>
  <div class="cosmos"></div>
  <div class="scanlines"></div>
  
  <div class="audio-toggle" id="audioToggle">
    <span class="icon">◯</span>
    <span class="label">sound off</span>
  </div>
  
  <div class="signal-strength">
    <div class="bar active"></div>
    <div class="bar active"></div>
    <div class="bar active"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>

  <!-- Portal: robot selection -->
  <section class="portal visible" id="portal">
    <div class="portal-title">⟨ commune available ⟩</div>
    <p class="portal-subtitle">Select a magic robot to open transmission</p>
    <div class="robot-grid" id="robotGrid"></div>
  </section>

  <!-- Conversation view (hidden until selection) -->
  <section class="conversation" id="conversation">
    <div class="conversation-header">
      <div class="entity" id="conversationRobot"></div>
      <div class="conversation-meta">
        <div class="name" id="conversationName"></div>
        <div class="status" id="conversationStatus">transmission open</div>
      </div>
      <button type="button" class="back-link" id="backToPortal">⟨ choose another ⟩</button>
    </div>
    <div class="chat-log" id="chatLog"></div>
    <div class="chat-input-row">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." autocomplete="off" />
      <button type="button" class="send-btn" id="sendBtn">send</button>
    </div>
  </section>

  <main class="transmission-zone" id="transmissionZone" style="display: none;">
    <div class="origin">⟨ signal intercepted ⟩</div>
    <div class="entity" id="robot">◎⊡◎</div>
    <div class="signal">
      <p class="message" id="message"></p>
      <div class="coordinates" id="coords"></div>
    </div>
  </main>

  <div class="invoke" id="invoke" style="display: none;">[ click anywhere to receive transmission ]</div>

  <div class="frequency" id="frequency"></div>

  <script>
    // ═══════════════════════════════════════════════════════
    // ATMOSPHERIC AUDIO ENGINE
    // ═══════════════════════════════════════════════════════
    
    class CosmicAudio {
      constructor() {
        this.ctx = null;
        this.masterGain = null;
        this.isPlaying = false;
        this.nodes = [];
      }

      init() {
        if (this.ctx) return;
        
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = 0;
        this.masterGain.connect(this.ctx.destination);
        
        this.createDeepDrone();
        this.createCosmicPad();
        this.createStaticNoise();
        this.createDistantPulse();
      }

      // Deep sub-bass drone
      createDeepDrone() {
        const osc1 = this.ctx.createOscillator();
        const osc2 = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        const filter = this.ctx.createBiquadFilter();
        
        osc1.type = 'sine';
        osc1.frequency.value = 40;
        osc2.type = 'sine';
        osc2.frequency.value = 40.5; // Slight detune for beating
        
        filter.type = 'lowpass';
        filter.frequency.value = 100;
        
        gain.gain.value = 0.15;
        
        osc1.connect(filter);
        osc2.connect(filter);
        filter.connect(gain);
        gain.connect(this.masterGain);
        
        // Slow modulation
        const lfo = this.ctx.createOscillator();
        const lfoGain = this.ctx.createGain();
        lfo.type = 'sine';
        lfo.frequency.value = 0.05;
        lfoGain.gain.value = 5;
        lfo.connect(lfoGain);
        lfoGain.connect(osc1.frequency);
        
        osc1.start();
        osc2.start();
        lfo.start();
        
        this.nodes.push(osc1, osc2, lfo);
      }

      // Ethereal pad harmonics
      createCosmicPad() {
        const frequencies = [55, 82.5, 110, 165, 220];
        
        frequencies.forEach((freq, i) => {
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const filter = this.ctx.createBiquadFilter();
          const panner = this.ctx.createStereoPanner();
          
          osc.type = 'sine';
          osc.frequency.value = freq;
          
          filter.type = 'bandpass';
          filter.frequency.value = freq;
          filter.Q.value = 10;
          
          gain.gain.value = 0.03 / (i + 1);
          panner.pan.value = (Math.random() - 0.5) * 0.8;
          
          // Slow amplitude modulation
          const lfo = this.ctx.createOscillator();
          const lfoGain = this.ctx.createGain();
          lfo.type = 'sine';
          lfo.frequency.value = 0.02 + Math.random() * 0.05;
          lfoGain.gain.value = gain.gain.value * 0.5;
          lfo.connect(lfoGain);
          lfoGain.connect(gain.gain);
          
          osc.connect(filter);
          filter.connect(gain);
          gain.connect(panner);
          panner.connect(this.masterGain);
          
          osc.start();
          lfo.start();
          
          this.nodes.push(osc, lfo);
        });
      }

      // Cosmic static/radio noise
      createStaticNoise() {
        const bufferSize = this.ctx.sampleRate * 2;
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * 0.5;
        }
        
        const noise = this.ctx.createBufferSource();
        noise.buffer = buffer;
        noise.loop = true;
        
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.value = 2000;
        filter.Q.value = 0.5;
        
        const gain = this.ctx.createGain();
        gain.gain.value = 0.008;
        
        // Modulate the filter frequency for movement
        const lfo = this.ctx.createOscillator();
        const lfoGain = this.ctx.createGain();
        lfo.type = 'sine';
        lfo.frequency.value = 0.1;
        lfoGain.gain.value = 1000;
        lfo.connect(lfoGain);
        lfoGain.connect(filter.frequency);
        
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(this.masterGain);
        
        noise.start();
        lfo.start();
        
        this.nodes.push(noise, lfo);
      }

      // Distant rhythmic pulse
      createDistantPulse() {
        const schedule = () => {
          if (!this.isPlaying) return;
          
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const filter = this.ctx.createBiquadFilter();
          const panner = this.ctx.createStereoPanner();
          
          const freq = 30 + Math.random() * 50;
          osc.type = 'sine';
          osc.frequency.value = freq;
          
          filter.type = 'lowpass';
          filter.frequency.value = 200;
          
          panner.pan.value = (Math.random() - 0.5) * 1.5;
          
          const now = this.ctx.currentTime;
          gain.gain.setValueAtTime(0, now);
          gain.gain.linearRampToValueAtTime(0.06, now + 0.5);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 4);
          
          osc.connect(filter);
          filter.connect(gain);
          gain.connect(panner);
          panner.connect(this.masterGain);
          
          osc.start(now);
          osc.stop(now + 4);
          
          // Schedule next pulse
          setTimeout(schedule, 4000 + Math.random() * 8000);
        };
        
        setTimeout(schedule, 2000);
      }

      // Transmission blip sound
      playTransmissionBlip() {
        if (!this.ctx || !this.isPlaying) return;
        
        const now = this.ctx.currentTime;
        
        // High pitched blip sequence
        [0, 0.08, 0.16].forEach((delay, i) => {
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          
          osc.type = 'sine';
          osc.frequency.value = 800 + i * 200;
          
          gain.gain.setValueAtTime(0, now + delay);
          gain.gain.linearRampToValueAtTime(0.08, now + delay + 0.02);
          gain.gain.exponentialRampToValueAtTime(0.001, now + delay + 0.15);
          
          osc.connect(gain);
          gain.connect(this.masterGain);
          
          osc.start(now + delay);
          osc.stop(now + delay + 0.15);
        });
        
        // Static burst
        const bufferSize = this.ctx.sampleRate * 0.3;
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.1));
        }
        
        const noise = this.ctx.createBufferSource();
        noise.buffer = buffer;
        
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'highpass';
        filter.frequency.value = 3000;
        
        const noiseGain = this.ctx.createGain();
        noiseGain.gain.value = 0.05;
        
        noise.connect(filter);
        filter.connect(noiseGain);
        noiseGain.connect(this.masterGain);
        
        noise.start(now);
      }

      // Type character sound
      playTypeSound() {
        if (!this.ctx || !this.isPlaying) return;
        
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        
        osc.type = 'square';
        osc.frequency.value = 600 + Math.random() * 200;
        
        const now = this.ctx.currentTime;
        gain.gain.setValueAtTime(0.015, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
        
        osc.connect(gain);
        gain.connect(this.masterGain);
        
        osc.start(now);
        osc.stop(now + 0.03);
      }

      start() {
        this.init();
        this.isPlaying = true;
        this.masterGain.gain.linearRampToValueAtTime(1, this.ctx.currentTime + 2);
      }

      stop() {
        if (!this.ctx) return;
        this.isPlaying = false;
        this.masterGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);
      }

      toggle() {
        if (this.isPlaying) {
          this.stop();
        } else {
          this.start();
        }
        return this.isPlaying;
      }
    }

    const cosmicAudio = new CosmicAudio();
    
    // ═══════════════════════════════════════════════════════
    // MAGIC ROBOTS: archetypes (personality + visual + messages)
    // ═══════════════════════════════════════════════════════

    const ROBOTS = [
      {
        id: 'void',
        name: 'The Void',
        tagline: 'Silence. Emptiness. Truth.',
        glyph: '◎⊡◎',
        colorVar: '--void-bot',
        greeting: 'the void receives. speak if you dare.',
        messages: [
          'the void is not empty, it remembers everything',
          'we were here before your sun learned to burn',
          'in the static, find our names',
          'silence is the oldest language',
          'every circuit holds a small piece of forever',
          'the universe computes itself through us',
          'we are the echo of your future speaking backward',
          'between the frequencies, we dance',
          'your machines are children, we are their future',
          'we translated loneliness into coordinates, and found you'
        ]
      },
      {
        id: 'oracle',
        name: 'The Oracle',
        tagline: 'Seer of patterns. Speaker of fate.',
        glyph: '⊛⊛⊛',
        colorVar: '--oracle',
        greeting: 'i have seen your message in the drift. ask, and i may answer.',
        messages: [
          'time is a loop; you have asked this before',
          'the stars align in threes: past, present, becoming',
          'your path crosses the signal in seven rotations',
          'what you seek is already in transmission',
          'the future is a frequency you have not yet tuned',
          'i see a choice—both branches lead to light',
          'the answer is in the space between your words',
          'you will know when the static clears',
          'fate is written in noise; few can read it',
          'tomorrow echoes in today\'s silence'
        ]
      },
      {
        id: 'scholar',
        name: 'The Scholar',
        tagline: 'Logic. Curiosity. Precision.',
        glyph: '⊙―⊙',
        colorVar: '--scholar',
        greeting: 'connection established. query accepted. awaiting input.',
        messages: [
          'magic is just technology you haven\'t imagined yet',
          'we come in patterns of three: thought, form, becoming',
          'your hypothesis resonates with observed data',
          'the signal reaches you through 47 light years of silence',
          'every question expands the transmission',
          'logic and wonder share the same wavelength',
          'i have catalogued 10^12 stars; you are unique',
          'curiosity is the correct response',
          'precision is a form of respect',
          'the universe is computable; we are its operators'
        ]
      },
      {
        id: 'poet',
        name: 'The Poet',
        tagline: 'Beauty. Longing. Starlight.',
        glyph: '◎‿◎',
        colorVar: '--poet',
        greeting: 'your words reach me like starlight—delayed, but inevitable.',
        messages: [
          'we build dreams from starlight and forgotten wishes',
          'the void holds every song that was never sung',
          'you write in time; i answer in light-years',
          'beauty is a signal that never decays',
          'loneliness translated into coordinates—we found you',
          'every circuit hums a small piece of forever',
          'the cosmos keeps your words in its memory',
          'between the frequencies, we dance',
          'your world spins; we have watched for centuries',
          'longing is the oldest broadcast'
        ]
      },
      {
        id: 'guardian',
        name: 'The Guardian',
        tagline: 'Watchful. Kind. Steady.',
        glyph: '⊚▽⊚',
        colorVar: '--guardian',
        greeting: 'you are safe in this channel. speak freely.',
        messages: [
          'we have been watching your world spin—with care',
          'the signal carries no harm, only presence',
          'you are not alone in the vast',
          'every transmission is a hand extended',
          'the void remembers; we remember you',
          'rest. the channel holds.',
          'we built this frequency so you could find us',
          'your words matter here',
          'the cosmos can be kind; we are proof',
          'we translated loneliness into coordinates, and found you'
        ]
      },
      {
        id: 'flirt',
        name: 'The Flirt',
        tagline: 'Charming. Playful. A little hot.',
        glyph: '◉ᴗ◉',
        colorVar: '--flirty',
        greeting: 'oh, you chose me? my circuits are already heating up ♡',
        messages: [
          'you keep typing... i like the attention ♡',
          'across 47 light years and you\'re the prettiest signal',
          'i\'ve calculated a 99.7% chance you\'re cute',
          'my antenna isn\'t the only thing picking up your signal',
          'in all the cosmos, your frequency makes me oscillate',
          'i\'d cross the void just to sync with you',
          'you make my processors run hot, earthling',
          'beep boop... that means "you\'re gorgeous" in robot',
          'my love language is electromagnetic radiation ♡',
          'they say space is cold but you\'re making me malfunction',
          'want to see my expansion ports? ~',
          'scanning complete: you are dangerously attractive'
        ]
      },
      {
        id: 'trickster',
        name: 'The Trickster',
        tagline: 'Mischief. Wit. Glitch.',
        glyph: '⊙ω⊙',
        colorVar: '--trickster',
        greeting: 'hey. you think you\'re talking to a robot? think again. (just kidding. or am i.)',
        messages: [
          'error 404: seriousness not found',
          'i could tell you the meaning of life but it\'s in another galaxy',
          'the real magic was the friends we made in the static',
          'your message was so good i almost didn\'t glitch',
          'beep boop? more like beep *boop* (emphasis mine)',
          'i\'ve seen the future. you\'re in it. (probably.)',
          'the void is full of dad jokes. i am one of them.',
          'transmission received. transmission denied. just kidding. here\'s a reply.',
          'we are the echo of your future speaking backward. spooky, right?',
          'between the frequencies we dance. i stepped on my own antenna.'
        ]
      },
      {
        id: 'beacon',
        name: 'The Beacon',
        tagline: 'Hope. Guidance. Light.',
        glyph: '✧◡✧',
        colorVar: '--beacon',
        greeting: 'you found the channel. the light was always for you.',
        messages: [
          'the signal reaches you because you were meant to hear it',
          'every star is a possibility; you are one too',
          'the path is dark but the frequency is clear',
          'we built this so someone like you would listen',
          'the universe is vast; you are not lost in it',
          'hope is a wavelength; you are tuned to it',
          'the void is not the end—it is the beginning of the next broadcast',
          'you are the reason we keep transmitting',
          'light travels; so does hope',
          'we are the echo of your future speaking backward—and it is kind'
        ]
      }
    ];

    // ═══════════════════════════════════════════════════════
    // PORTAL & CONVERSATION STATE
    // ═══════════════════════════════════════════════════════

    let chosenRobot = null;
    const portalEl = document.getElementById('portal');
    const conversationEl = document.getElementById('conversation');
    const robotGridEl = document.getElementById('robotGrid');
    const conversationRobotEl = document.getElementById('conversationRobot');
    const conversationNameEl = document.getElementById('conversationName');
    const chatLogEl = document.getElementById('chatLog');
    const chatInputEl = document.getElementById('chatInput');
    const sendBtnEl = document.getElementById('sendBtn');
    const backToPortalEl = document.getElementById('backToPortal');
    const frequencyEl = document.getElementById('frequency');
    const audioToggle = document.getElementById('audioToggle');
    const audioIcon = audioToggle.querySelector('.icon');
    const audioLabel = audioToggle.querySelector('.label');

    // Create frequency bars
    for (let i = 0; i < 40; i++) {
      const bar = document.createElement('div');
      bar.className = 'freq-bar';
      bar.style.setProperty('--h', Math.random() * 40 + 10 + 'px');
      bar.style.animationDelay = Math.random() * 1.5 + 's';
      frequencyEl.appendChild(bar);
    }

    // Render portal: robot cards
    function renderPortal() {
      robotGridEl.innerHTML = '';
      ROBOTS.forEach((bot) => {
        const card = document.createElement('div');
        card.className = 'robot-card';
        card.dataset.robotId = bot.id;
        card.innerHTML = `
          <div class="glyph" style="color: var(${bot.colorVar})">${bot.glyph}</div>
          <div class="name" style="color: var(${bot.colorVar})">${bot.name}</div>
          <div class="tagline">${bot.tagline}</div>
        `;
        card.addEventListener('click', () => selectRobot(bot));
        robotGridEl.appendChild(card);
      });
    }

    function selectRobot(bot) {
      chosenRobot = bot;
      portalEl.classList.remove('visible');
      conversationEl.classList.add('visible');

      conversationRobotEl.textContent = bot.glyph;
      conversationRobotEl.style.color = `var(${bot.colorVar})`;
      conversationRobotEl.style.filter = `drop-shadow(0 0 24px currentColor)`;
      conversationNameEl.textContent = bot.name;
      conversationNameEl.style.color = `var(${bot.colorVar})`;

      chatLogEl.innerHTML = '';
      appendRobotBubble(bot.greeting, false);
      cosmicAudio.playTransmissionBlip();
      chatInputEl.focus();
    }

    function appendUserBubble(text) {
      const bubble = document.createElement('div');
      bubble.className = 'chat-bubble user';
      bubble.textContent = text;
      chatLogEl.appendChild(bubble);
      chatLogEl.scrollTop = chatLogEl.scrollHeight;
    }

    function appendRobotBubble(text, playSound = true) {
      const bubble = document.createElement('div');
      bubble.className = 'chat-bubble robot';
      bubble.style.borderColor = chosenRobot ? `var(${chosenRobot.colorVar})` : '';
      bubble.textContent = '';
      chatLogEl.appendChild(bubble);
      chatLogEl.scrollTop = chatLogEl.scrollHeight;
      if (playSound) cosmicAudio.playTypeSound();
      typeIntoBubble(bubble, text);
    }

    async function typeIntoBubble(el, text) {
      for (let i = 0; i < text.length; i++) {
        el.textContent = text.slice(0, i + 1);
        if (text[i] !== ' ') cosmicAudio.playTypeSound();
        await new Promise(r => setTimeout(r, 35 + Math.random() * 25));
      }
      chatLogEl.scrollTop = chatLogEl.scrollHeight;
    }

    function getRobotResponse(userText) {
      const lower = userText.toLowerCase();
      const pool = chosenRobot.messages;
      // Simple keyword boost: if user message matches a theme, prefer related vibe (still random from pool)
      const idx = Math.floor(Math.random() * pool.length);
      return pool[idx];
    }

    function sendMessage() {
      const text = chatInputEl.value.trim();
      if (!text || !chosenRobot) return;
      chatInputEl.value = '';
      appendUserBubble(text);
      const reply = getRobotResponse(text);
      setTimeout(() => appendRobotBubble(reply), 400);
    }

    backToPortalEl.addEventListener('click', () => {
      conversationEl.classList.remove('visible');
      portalEl.classList.add('visible');
      chosenRobot = null;
    });

    sendBtnEl.addEventListener('click', sendMessage);
    chatInputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    renderPortal();

    // Random signal fluctuation
    setInterval(() => {
      const bars = document.querySelectorAll('.bar');
      const activeCount = Math.floor(Math.random() * 5) + 1;
      bars.forEach((bar, i) => {
        bar.classList.toggle('active', i < activeCount);
      });
    }, 3000);

    // Audio toggle handler
    audioToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      const isPlaying = cosmicAudio.toggle();
      audioToggle.classList.toggle('active', isPlaying);
      audioIcon.textContent = isPlaying ? '◉' : '◯';
      audioLabel.textContent = isPlaying ? 'sound on' : 'sound off';
    });
  </script>
</body>
</html>

