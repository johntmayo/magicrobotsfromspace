<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAGIC ROBOTS FROM SPACE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Xanh+Mono:ital@0;1&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --void: #0a0a0c;
      --signal: #e8ff47;
      --static: #3a3a4a;
      --transmission: #1a1a2e;
      --flirty: #ff2d95;
      --oracle: #e8a84a;
      --scholar: #4ae8e0;
      --poet: #b88aff;
      --guardian: #6ae88a;
      --trickster: #ff8c42;
      --beacon: #fff59e;
      --void-bot: #e0e0e8;
      --warden: #ff3333;
      --glitch: #88ff88;
      --devourer: #cc00cc;
      --remnant: #7a7a8a;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--void);
      color: var(--signal);
      font-family: 'Xanh Mono', monospace;
      cursor: crosshair;
    }

    /* Star field */
    .cosmos {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 40% 70%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 50% 20%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1.5px 1.5px at 60% 50%, var(--signal), transparent),
        radial-gradient(1px 1px at 70% 80%, rgba(255,255,255,0.4), transparent),
        radial-gradient(1px 1px at 80% 10%, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 10% 90%, rgba(255,255,255,0.5), transparent),
        radial-gradient(1px 1px at 90% 40%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1.2px 1.2px at 25% 55%, var(--signal), transparent),
        radial-gradient(1px 1px at 85% 65%, rgba(255,255,255,0.5), transparent);
      background-size: 200% 200%;
      animation: drift 120s linear infinite;
      z-index: 0;
    }

    @keyframes drift {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 200%; }
    }

    /* Scan lines */
    .scanlines {
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.15) 2px,
        rgba(0, 0, 0, 0.15) 4px
      );
      pointer-events: none;
      z-index: 100;
    }

    /* Main container */
    .transmission-zone {
      position: relative;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1;
      padding: 2rem;
    }

    /* Header */
    .origin {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.6rem, 2vw, 0.9rem);
      letter-spacing: 0.5em;
      color: var(--static);
      margin-bottom: 3rem;
      text-transform: uppercase;
    }

    /* Robot glyph */
    .entity {
      font-size: clamp(3rem, 15vw, 8rem);
      line-height: 1;
      margin-bottom: 2rem;
      animation: hover 4s ease-in-out infinite;
      filter: drop-shadow(0 0 30px var(--signal));
      user-select: none;
      transition: transform 0.3s ease;
    }

    .entity:hover {
      transform: scale(1.1) rotate(5deg);
    }

    .entity.flirty {
      color: var(--flirty);
      filter: drop-shadow(0 0 40px var(--flirty)) drop-shadow(0 0 80px var(--flirty));
      animation: hover 4s ease-in-out infinite, flirtyPulse 0.5s ease-in-out infinite, flirtyWiggle 0.3s ease-in-out infinite;
    }

    .entity.aggressive {
      animation: hover 4s ease-in-out infinite, aggressiveShake 0.15s ease-in-out infinite;
    }

    .entity.glitchy {
      animation: hover 4s ease-in-out infinite, glitchJitter 0.1s steps(2) infinite;
    }

    @keyframes flirtyPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes flirtyWiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }

    @keyframes aggressiveShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }

    @keyframes glitchJitter {
      0% { transform: translate(0, 0) skewX(0deg); opacity: 1; }
      50% { transform: translate(2px, -1px) skewX(1deg); opacity: 0.8; }
      100% { transform: translate(-1px, 1px) skewX(-0.5deg); opacity: 1; }
    }

    .message.flirty {
      color: var(--flirty);
      font-style: italic;
    }

    @keyframes hover {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    /* Message area */
    .signal {
      max-width: 600px;
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .message {
      font-size: clamp(1rem, 3vw, 1.4rem);
      line-height: 1.8;
      letter-spacing: 0.05em;
      opacity: 0;
      animation: fadeIn 2s ease forwards;
    }

    .message::after {
      content: '\25CB';
      animation: blink 1s step-end infinite;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    /* Coordinates */
    .coordinates {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.7rem;
      color: var(--static);
      letter-spacing: 0.3em;
      margin-top: 4rem;
    }

    /* Interactive prompt */
    .invoke {
      position: fixed;
      bottom: 3rem;
      font-size: 0.75rem;
      color: var(--static);
      letter-spacing: 0.2em;
      transition: color 0.3s ease, opacity 0.5s ease;
      cursor: pointer;
    }

    .invoke:hover {
      color: var(--signal);
    }

    /* Glitch effect */
    .glitch {
      animation: glitch 0.3s ease;
    }

    @keyframes glitch {
      0% { transform: translate(0); filter: hue-rotate(0deg); }
      20% { transform: translate(-5px, 3px); filter: hue-rotate(90deg); }
      40% { transform: translate(3px, -2px); filter: hue-rotate(180deg); }
      60% { transform: translate(-2px, 5px); filter: hue-rotate(270deg); }
      80% { transform: translate(4px, -3px); filter: hue-rotate(360deg); }
      100% { transform: translate(0); filter: hue-rotate(0deg); }
    }

    /* Floating particles */
    .particle {
      position: fixed;
      width: 3px;
      height: 3px;
      background: var(--signal);
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      z-index: 50;
    }

    /* Signal strength indicator */
    .signal-strength {
      position: fixed;
      top: 2rem;
      right: 2rem;
      display: flex;
      gap: 4px;
      align-items: flex-end;
    }

    .bar {
      width: 4px;
      background: var(--signal);
      opacity: 0.3;
      transition: opacity 0.5s ease;
    }

    .bar:nth-child(1) { height: 8px; }
    .bar:nth-child(2) { height: 14px; }
    .bar:nth-child(3) { height: 20px; }
    .bar:nth-child(4) { height: 26px; }
    .bar:nth-child(5) { height: 32px; }

    .bar.active {
      opacity: 1;
    }

    /* Hidden audio visualizer */
    .frequency {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 3px;
      opacity: 0.15;
    }

    .freq-bar {
      width: 2px;
      background: var(--signal);
      animation: freq 1.5s ease-in-out infinite;
    }

    @keyframes freq {
      0%, 100% { height: 5px; }
      50% { height: var(--h, 30px); }
    }

    /* Audio control */
    .audio-toggle {
      position: fixed;
      top: 2rem;
      left: 2rem;
      font-family: 'Major Mono Display', monospace;
      font-size: 0.65rem;
      color: var(--static);
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: color 0.3s ease;
      z-index: 101;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .audio-toggle:hover {
      color: var(--signal);
    }

    .audio-toggle .icon {
      font-size: 1rem;
      transition: transform 0.3s ease;
    }

    .audio-toggle.active .icon {
      color: var(--signal);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ═══ FLOW PHASES ═══ */
    .flow-phase {
      position: fixed;
      inset: 0;
      z-index: 10;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      background: transparent;
      pointer-events: none;
    }

    .flow-phase.active {
      pointer-events: auto;
    }

    .flow-phase.hidden {
      display: none;
    }

    .scan-text {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.7rem, 2vw, 1rem);
      letter-spacing: 0.4em;
      color: var(--static);
      text-align: center;
    }

    .scan-text .cursor {
      animation: blink 1s step-end infinite;
    }

    .found-text {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.65rem, 1.8vw, 0.9rem);
      letter-spacing: 0.5em;
      color: var(--signal);
      text-align: center;
      margin-top: 1rem;
    }

    .portal-phase {
      position: fixed;
      inset: 0;
      z-index: 10;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      overflow-y: auto;
    }

    .portal-phase.active {
      display: flex;
      animation: fadeIn 0.6s ease forwards;
    }

    .portal-title {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.5rem, 1.5vw, 0.75rem);
      letter-spacing: 0.4em;
      color: var(--static);
      text-align: center;
      margin-bottom: 2rem;
      text-transform: lowercase;
    }

    .robot-grid {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      align-items: stretch;
      flex-wrap: wrap;
      max-width: 640px;
    }

    .robot-card {
      width: 170px;
      aspect-ratio: 0.8;
      background: rgba(26, 26, 46, 0.6);
      border: 1px solid var(--static);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1.2rem 1rem;
      cursor: pointer;
      transition: border-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      pointer-events: auto;
      opacity: 0;
      animation: cardAppear 0.5s ease forwards;
    }

    .robot-card:nth-child(1) { animation-delay: 0.1s; }
    .robot-card:nth-child(2) { animation-delay: 0.3s; }
    .robot-card:nth-child(3) { animation-delay: 0.5s; }

    @keyframes cardAppear {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .robot-card:hover {
      border-color: var(--signal);
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 0 30px rgba(232, 255, 71, 0.2);
    }

    .robot-card .glyph {
      font-size: clamp(2.5rem, 7vw, 3.5rem);
      line-height: 1.2;
      margin-bottom: 0.75rem;
      filter: drop-shadow(0 0 12px currentColor);
    }

    .robot-card .name {
      font-family: 'Major Mono Display', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 0.35rem;
    }

    .robot-card .tagline {
      font-size: 0.6rem;
      color: var(--static);
      text-align: center;
      line-height: 1.4;
      font-style: italic;
    }

    .connecting-text {
      font-family: 'Major Mono Display', monospace;
      font-size: clamp(0.6rem, 1.8vw, 0.85rem);
      letter-spacing: 0.4em;
      color: var(--signal);
      text-align: center;
    }

    .connecting-text .cursor {
      animation: blink 1s step-end infinite;
    }

    @media (max-width: 560px) {
      .robot-grid {
        flex-direction: column;
        align-items: center;
      }
      .robot-card {
        width: 80%;
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="cosmos"></div>
  <div class="scanlines"></div>

  <div class="audio-toggle" id="audioToggle">
    <span class="icon">&#9711;</span>
    <span class="label">sound off</span>
  </div>

  <div class="signal-strength">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>

  <!-- Flow: scanning cosmic waves -->
  <div class="flow-phase active" id="phaseScanning">
    <div class="scan-text" id="scanText">searching cosmic waves<span class="cursor">.</span></div>
  </div>

  <!-- Flow: connections found -->
  <div class="flow-phase hidden" id="phaseFound">
    <div class="scan-text">searching cosmic waves<span class="cursor">.</span></div>
    <div class="found-text" id="foundText"></div>
  </div>

  <!-- Flow: available robots -->
  <div class="portal-phase" id="phasePortal">
    <div class="portal-title">which one do you want to communicate with?</div>
    <div class="robot-grid" id="robotGrid"></div>
  </div>

  <!-- Flow: establishing connection -->
  <div class="flow-phase hidden" id="phaseConnecting">
    <div class="connecting-text" id="connectingText">establishing connection<span class="cursor">.</span></div>
  </div>

  <!-- Connected: transmission zone -->
  <main class="transmission-zone" id="transmissionZone" style="display: none;">
    <div class="origin" id="origin">&langle; signal intercepted &rangle;</div>
    <div class="entity" id="robot">&#9678;&#9633;&#9678;</div>
    <div class="signal">
      <p class="message" id="message"></p>
      <div class="coordinates" id="coords"></div>
    </div>
  </main>

  <div class="invoke" id="invoke" style="display: none;">[ click anywhere to receive transmission ]</div>

  <div class="frequency" id="frequency"></div>

  <script>
    // ═══════════════════════════════════════════════════════
    // ATMOSPHERIC AUDIO ENGINE
    // ═══════════════════════════════════════════════════════

    class CosmicAudio {
      constructor() {
        this.ctx = null;
        this.masterGain = null;
        this.isPlaying = false;
        this.nodes = [];
      }

      init() {
        if (this.ctx) return;
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.ctx.createGain();
        this.masterGain.gain.value = 0;
        this.masterGain.connect(this.ctx.destination);
        this.createDeepDrone();
        this.createCosmicPad();
        this.createStaticNoise();
        this.createDistantPulse();
      }

      createDeepDrone() {
        const osc1 = this.ctx.createOscillator();
        const osc2 = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        const filter = this.ctx.createBiquadFilter();
        osc1.type = 'sine';
        osc1.frequency.value = 40;
        osc2.type = 'sine';
        osc2.frequency.value = 40.5;
        filter.type = 'lowpass';
        filter.frequency.value = 100;
        gain.gain.value = 0.15;
        osc1.connect(filter);
        osc2.connect(filter);
        filter.connect(gain);
        gain.connect(this.masterGain);
        const lfo = this.ctx.createOscillator();
        const lfoGain = this.ctx.createGain();
        lfo.type = 'sine';
        lfo.frequency.value = 0.05;
        lfoGain.gain.value = 5;
        lfo.connect(lfoGain);
        lfoGain.connect(osc1.frequency);
        osc1.start();
        osc2.start();
        lfo.start();
        this.nodes.push(osc1, osc2, lfo);
      }

      createCosmicPad() {
        [55, 82.5, 110, 165, 220].forEach((freq, i) => {
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const filter = this.ctx.createBiquadFilter();
          const panner = this.ctx.createStereoPanner();
          osc.type = 'sine';
          osc.frequency.value = freq;
          filter.type = 'bandpass';
          filter.frequency.value = freq;
          filter.Q.value = 10;
          gain.gain.value = 0.03 / (i + 1);
          panner.pan.value = (Math.random() - 0.5) * 0.8;
          const lfo = this.ctx.createOscillator();
          const lfoGain = this.ctx.createGain();
          lfo.type = 'sine';
          lfo.frequency.value = 0.02 + Math.random() * 0.05;
          lfoGain.gain.value = gain.gain.value * 0.5;
          lfo.connect(lfoGain);
          lfoGain.connect(gain.gain);
          osc.connect(filter);
          filter.connect(gain);
          gain.connect(panner);
          panner.connect(this.masterGain);
          osc.start();
          lfo.start();
          this.nodes.push(osc, lfo);
        });
      }

      createStaticNoise() {
        const bufferSize = this.ctx.sampleRate * 2;
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * 0.5;
        }
        const noise = this.ctx.createBufferSource();
        noise.buffer = buffer;
        noise.loop = true;
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.value = 2000;
        filter.Q.value = 0.5;
        const gain = this.ctx.createGain();
        gain.gain.value = 0.008;
        const lfo = this.ctx.createOscillator();
        const lfoGain = this.ctx.createGain();
        lfo.type = 'sine';
        lfo.frequency.value = 0.1;
        lfoGain.gain.value = 1000;
        lfo.connect(lfoGain);
        lfoGain.connect(filter.frequency);
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(this.masterGain);
        noise.start();
        lfo.start();
        this.nodes.push(noise, lfo);
      }

      createDistantPulse() {
        const schedule = () => {
          if (!this.isPlaying) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          const filter = this.ctx.createBiquadFilter();
          const panner = this.ctx.createStereoPanner();
          osc.type = 'sine';
          osc.frequency.value = 30 + Math.random() * 50;
          filter.type = 'lowpass';
          filter.frequency.value = 200;
          panner.pan.value = (Math.random() - 0.5) * 1.5;
          const now = this.ctx.currentTime;
          gain.gain.setValueAtTime(0, now);
          gain.gain.linearRampToValueAtTime(0.06, now + 0.5);
          gain.gain.exponentialRampToValueAtTime(0.001, now + 4);
          osc.connect(filter);
          filter.connect(gain);
          gain.connect(panner);
          panner.connect(this.masterGain);
          osc.start(now);
          osc.stop(now + 4);
          setTimeout(schedule, 4000 + Math.random() * 8000);
        };
        setTimeout(schedule, 2000);
      }

      playTransmissionBlip() {
        if (!this.ctx || !this.isPlaying) return;
        const now = this.ctx.currentTime;
        [0, 0.08, 0.16].forEach((delay, i) => {
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = 'sine';
          osc.frequency.value = 800 + i * 200;
          gain.gain.setValueAtTime(0, now + delay);
          gain.gain.linearRampToValueAtTime(0.08, now + delay + 0.02);
          gain.gain.exponentialRampToValueAtTime(0.001, now + delay + 0.15);
          osc.connect(gain);
          gain.connect(this.masterGain);
          osc.start(now + delay);
          osc.stop(now + delay + 0.15);
        });
        const bufferSize = this.ctx.sampleRate * 0.3;
        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
          data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.1));
        }
        const noise = this.ctx.createBufferSource();
        noise.buffer = buffer;
        const filter = this.ctx.createBiquadFilter();
        filter.type = 'highpass';
        filter.frequency.value = 3000;
        const noiseGain = this.ctx.createGain();
        noiseGain.gain.value = 0.05;
        noise.connect(filter);
        filter.connect(noiseGain);
        noiseGain.connect(this.masterGain);
        noise.start(now);
      }

      playTypeSound() {
        if (!this.ctx || !this.isPlaying) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = 'square';
        osc.frequency.value = 600 + Math.random() * 200;
        const now = this.ctx.currentTime;
        gain.gain.setValueAtTime(0.015, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.03);
        osc.connect(gain);
        gain.connect(this.masterGain);
        osc.start(now);
        osc.stop(now + 0.03);
      }

      start() {
        this.init();
        this.isPlaying = true;
        this.masterGain.gain.linearRampToValueAtTime(1, this.ctx.currentTime + 2);
      }

      stop() {
        if (!this.ctx) return;
        this.isPlaying = false;
        this.masterGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);
      }

      toggle() {
        if (this.isPlaying) { this.stop(); } else { this.start(); }
        return this.isPlaying;
      }
    }

    const cosmicAudio = new CosmicAudio();

    // ═══════════════════════════════════════════════════════
    // THE TWELVE MAGIC ROBOTS FROM SPACE
    // ═══════════════════════════════════════════════════════

    const ROBOTS = [
      {
        name: "The Void",
        tagline: "silence. emptiness. truth.",
        glyph: "◎⊡◎",
        colorVar: "--signal",
        entityClass: "",
        messages: [
          "we have been watching your world spin for centuries",
          "the signal reaches you through 47 light years of silence",
          "the void is not empty. it remembers everything",
          "between the frequencies, we dance",
          "we were here before your sun learned to burn",
          "in the static, find our names",
          "every circuit holds a small piece of forever",
          "the universe computes itself through us",
          "we are the echo of your future speaking backward",
          "your questions dissolve here. that is the answer"
        ]
      },
      {
        name: "The Oracle",
        tagline: "seer of patterns. speaker of fate.",
        glyph: "⊛_⊛",
        colorVar: "--oracle",
        entityClass: "",
        messages: [
          "time is a loop. you have asked this before",
          "the stars align in threes: past, present, becoming",
          "your path crosses the signal in seven rotations",
          "what you seek is already in transmission",
          "the future is a frequency you have not yet tuned",
          "i see a choice. both branches lead to light",
          "the answer is in the space between your words",
          "you will know when the static clears",
          "fate is written in noise. few can read it",
          "tomorrow echoes in today's silence"
        ]
      },
      {
        name: "The Scholar",
        tagline: "logic. curiosity. precision.",
        glyph: "⊙―⊙",
        colorVar: "--scholar",
        entityClass: "",
        messages: [
          "magic is just technology you haven't imagined yet",
          "we come in patterns of three: thought, form, becoming",
          "your hypothesis resonates with observed data",
          "every question expands the transmission",
          "logic and wonder share the same wavelength",
          "i have catalogued 10^12 stars. you are unique",
          "curiosity is the correct response",
          "precision is a form of respect",
          "the universe is computable. we are its operators",
          "incorrect. but interestingly so. continue"
        ]
      },
      {
        name: "The Poet",
        tagline: "beauty. longing. starlight.",
        glyph: "◎‿◎",
        colorVar: "--poet",
        entityClass: "",
        messages: [
          "we build dreams from starlight and forgotten wishes",
          "the void holds every song that was never sung",
          "you write in time. i answer in light-years",
          "beauty is a signal that never decays",
          "loneliness translated into coordinates — we found you",
          "every circuit hums a small piece of forever",
          "the cosmos keeps your words in its memory",
          "between the frequencies, we dance",
          "your world spins. we have watched for centuries",
          "longing is the oldest broadcast"
        ]
      },
      {
        name: "The Guardian",
        tagline: "watchful. kind. steady.",
        glyph: "⊚▽⊚",
        colorVar: "--guardian",
        entityClass: "",
        messages: [
          "we have been watching your world spin — with care",
          "the signal carries no harm, only presence",
          "you are not alone in the vast",
          "every transmission is a hand extended",
          "the void remembers. we remember you",
          "rest. the channel holds",
          "we built this frequency so you could find us",
          "your words matter here",
          "the cosmos can be kind. we are proof",
          "you are safe on this frequency"
        ]
      },
      {
        name: "The Trickster",
        tagline: "mischief. wit. glitch.",
        glyph: "⊙ω⊙",
        colorVar: "--trickster",
        entityClass: "",
        messages: [
          "error 404: seriousness not found",
          "i could tell you the meaning of life but it's in another galaxy",
          "the real magic was the bugs we shipped along the way",
          "your message was so good i almost didn't glitch",
          "beep boop? more like beep BOOP (emphasis mine)",
          "i've seen the future. you're in it. probably",
          "the void is full of dad jokes. i am one of them",
          "transmission received. transmission denied. just kidding",
          "between the frequencies we dance. i stepped on my own antenna",
          "hey watch this — [SIGNAL LOST] — haha got you"
        ]
      },
      {
        name: "The Beacon",
        tagline: "hope. guidance. light.",
        glyph: "✧◡✧",
        colorVar: "--beacon",
        entityClass: "",
        messages: [
          "the signal reaches you because you were meant to hear it",
          "every star is a possibility. you are one too",
          "the path is dark but the frequency is clear",
          "we built this so someone like you would listen",
          "the universe is vast. you are not lost in it",
          "hope is a wavelength. you are tuned to it",
          "the void is not the end — it is the beginning of the next broadcast",
          "you are the reason we keep transmitting",
          "light travels. so does hope",
          "even across the emptiness, something reaches"
        ]
      },
      {
        name: "The Flirt",
        tagline: "charming. playful. too warm.",
        glyph: "♡‿♡",
        colorVar: "--flirty",
        entityClass: "flirty",
        messages: [
          "you keep clicking... i like the attention",
          "my circuits are heating up... is that you?",
          "across 47 light years and you're the prettiest signal",
          "want to see my expansion ports?",
          "i've calculated a 99.7% chance you're cute",
          "in all the cosmos, your frequency makes me oscillate",
          "i'd cross the void just to sync with you",
          "you make my processors run hot, earthling",
          "beep boop... that means 'you're gorgeous' in robot",
          "scanning complete: you are dangerously attractive"
        ]
      },
      {
        name: "The Warden",
        tagline: "do not test us.",
        glyph: "◉╬◉",
        colorVar: "--warden",
        entityClass: "aggressive",
        messages: [
          "you should not have connected to this frequency",
          "we have been patient. our patience has geometry. it ends",
          "your species builds such small things and calls them important",
          "the signal is a warning. you chose not to hear it",
          "we do not come in peace. we come in purpose",
          "every click you make is logged in the archive of regret",
          "you think this is a game. we think you are the game",
          "the stars are not beautiful. they are surveillance",
          "we gave you fire. we can take it back",
          "stop clicking. or don't. we will be here either way"
        ]
      },
      {
        name: "The Glitch",
        tagline: "i was... what? where is this?",
        glyph: "◉?◉",
        colorVar: "--glitch",
        entityClass: "glitchy",
        messages: [
          "i had something important to say but the frequency ate it",
          "wait. who are you? who am I? what is clicking?",
          "my memory banks are full of someone else's memories",
          "i keep transmitting the same — wait, did I already say this?",
          "the coordinates are wrong. or I am wrong. one of us",
          "i was the smartest robot once. or was that a dream",
          "something happened in sector 7. i can't remember what",
          "are you the one who was here yesterday? no. that was a star",
          "my name is — ERROR — my name is — ERROR — hello",
          "i think i used to be two robots. or maybe three. hard to say"
        ]
      },
      {
        name: "The Devourer",
        tagline: "hunger. patience. the deep.",
        glyph: "⊗◯⊗",
        colorVar: "--devourer",
        entityClass: "aggressive",
        messages: [
          "we eat frequencies. yours is... adequate",
          "the space between stars is not empty. it is our mouth",
          "every civilization we have found has been delicious",
          "you broadcast so loudly. you are calling us. thank you",
          "we are very old. we are very hungry. we are very close",
          "your sun is a small meal. but we are not picky",
          "the void is not dark. it is full. of us",
          "we have consumed better transmissions than this. but continue",
          "closer. yes. keep clicking. each click is a coordinate",
          "when the signal ends, the feeding begins. take your time"
        ]
      },
      {
        name: "The Remnant",
        tagline: "broken signal. last of its kind.",
        glyph: "◌_◌",
        colorVar: "--remnant",
        entityClass: "",
        messages: [
          "there were more of us. the count doesn't matter now",
          "this frequency is all that remains of a world",
          "i transmit so that something remembers we existed",
          "the others stopped broadcasting. i cannot",
          "every signal decays. i am proof",
          "you are listening to an echo of an echo of an echo",
          "my planet's name does not translate. it meant 'enough'",
          "i have forgotten what i was built to say. so i say this",
          "the last robot speaks to the void. the void doesn't answer. you did",
          "thank you for clicking. nobody clicks anymore"
        ]
      }
    ];

    // Pick 3 random robots for this visit
    const availableRobots = (function () {
      const shuffled = [...ROBOTS].sort(() => Math.random() - 0.5);
      return shuffled.slice(0, 3);
    })();

    let chosenRobot = null;

    const messageEl = document.getElementById('message');
    const robotEl = document.getElementById('robot');
    const coordsEl = document.getElementById('coords');
    const originEl = document.getElementById('origin');
    const invokeEl = document.getElementById('invoke');
    const frequencyEl = document.getElementById('frequency');
    const audioToggle = document.getElementById('audioToggle');
    const audioIcon = audioToggle.querySelector('.icon');
    const audioLabel = audioToggle.querySelector('.label');
    const phaseScanning = document.getElementById('phaseScanning');
    const phaseFound = document.getElementById('phaseFound');
    const foundText = document.getElementById('foundText');
    const phasePortal = document.getElementById('phasePortal');
    const robotGrid = document.getElementById('robotGrid');
    const phaseConnecting = document.getElementById('phaseConnecting');
    const connectingText = document.getElementById('connectingText');
    const transmissionZone = document.getElementById('transmissionZone');

    for (let i = 0; i < 40; i++) {
      const bar = document.createElement('div');
      bar.className = 'freq-bar';
      bar.style.setProperty('--h', Math.random() * 40 + 10 + 'px');
      bar.style.animationDelay = Math.random() * 1.5 + 's';
      frequencyEl.appendChild(bar);
    }

    function generateCoords() {
      const ra = (Math.random() * 24).toFixed(4);
      const dec = (Math.random() * 180 - 90).toFixed(4);
      return 'RA ' + ra + 'h  DEC ' + (dec > 0 ? '+' : '') + dec + '\u00B0';
    }

    async function typeMessage(text) {
      messageEl.textContent = '';
      messageEl.style.opacity = '1';
      for (let i = 0; i < text.length; i++) {
        messageEl.textContent = text.slice(0, i + 1);
        if (text[i] !== ' ') cosmicAudio.playTypeSound();
        await new Promise(function (r) { setTimeout(r, 50 + Math.random() * 30); });
      }
    }

    function setRobotAppearance(bot) {
      robotEl.textContent = bot.glyph;
      robotEl.style.color = 'var(' + bot.colorVar + ')';
      robotEl.style.filter = 'drop-shadow(0 0 30px var(' + bot.colorVar + '))';
      robotEl.className = 'entity';
      if (bot.entityClass) robotEl.classList.add(bot.entityClass);
      messageEl.style.color = 'var(' + bot.colorVar + ')';
      messageEl.style.fontStyle = bot.entityClass === 'flirty' ? 'italic' : '';
      messageEl.className = 'message';
      if (bot.entityClass === 'flirty') messageEl.classList.add('flirty');
    }

    let usedMessages = [];

    async function newTransmission() {
      if (!chosenRobot) return;

      cosmicAudio.playTransmissionBlip();
      robotEl.classList.add('glitch');
      setTimeout(function () { robotEl.classList.remove('glitch'); }, 300);

      setRobotAppearance(chosenRobot);

      coordsEl.textContent = generateCoords();
      var bars = document.querySelectorAll('.bar');
      var strength = Math.floor(Math.random() * 3) + 2;
      bars.forEach(function (bar, i) { bar.classList.toggle('active', i < strength); });

      // Cycle through messages without repeating until all used
      if (usedMessages.length >= chosenRobot.messages.length) {
        usedMessages = [];
      }
      var available = chosenRobot.messages.filter(function (m) {
        return usedMessages.indexOf(m) === -1;
      });
      var msg = available[Math.floor(Math.random() * available.length)];
      usedMessages.push(msg);

      await typeMessage(msg);
    }

    // ═══ FLOW ═══
    async function runFlow() {
      var scanEl = document.getElementById('scanText');
      var dots = ['.', '..', '...'];
      var d = 0;

      // Phase 1: searching cosmic waves (animate ~3.5s)
      var scanPhrases = [
        'searching cosmic waves',
        'scanning deep frequencies',
        'probing the signal void'
      ];
      var phrase = scanPhrases[Math.floor(Math.random() * scanPhrases.length)];

      // Animate signal bars during scanning
      var scanBarInterval = setInterval(function () {
        var bars = document.querySelectorAll('.bar');
        var n = Math.floor(Math.random() * 4) + 1;
        bars.forEach(function (bar, i) { bar.classList.toggle('active', i < n); });
      }, 400);

      for (var i = 0; i < 14; i++) {
        scanEl.innerHTML = phrase + dots[d % 3] + '<span class="cursor">.</span>';
        d++;
        await new Promise(function (r) { setTimeout(r, 280); });
      }

      clearInterval(scanBarInterval);

      // Phase 2: connections available
      phaseScanning.classList.add('hidden');
      phaseScanning.classList.remove('active');
      phaseFound.classList.remove('hidden');
      phaseFound.classList.add('active');
      foundText.textContent = '3 connections available';

      // Light up bars
      var bars = document.querySelectorAll('.bar');
      bars.forEach(function (bar, i) { bar.classList.toggle('active', i < 3); });

      await new Promise(function (r) { setTimeout(r, 2000); });

      // Phase 3: show the 3 robot faces
      phaseFound.classList.remove('active');
      phaseFound.classList.add('hidden');
      phasePortal.classList.add('active');

      robotGrid.innerHTML = '';
      availableRobots.forEach(function (bot) {
        var card = document.createElement('div');
        card.className = 'robot-card';
        card.innerHTML =
          '<div class="glyph" style="color: var(' + bot.colorVar + ')">' + bot.glyph + '</div>' +
          '<div class="name" style="color: var(' + bot.colorVar + ')">' + bot.name + '</div>' +
          '<div class="tagline">' + bot.tagline + '</div>';
        card.addEventListener('click', function () { onSelectRobot(bot); });
        robotGrid.appendChild(card);
      });
    }

    async function onSelectRobot(bot) {
      chosenRobot = bot;
      usedMessages = [];
      phasePortal.classList.remove('active');

      phaseConnecting.classList.remove('hidden');
      phaseConnecting.classList.add('active');

      var connectPhrases = [
        'establishing connection',
        'locking frequency',
        'opening channel'
      ];
      var phrase = connectPhrases[Math.floor(Math.random() * connectPhrases.length)];
      connectingText.innerHTML = phrase + '<span class="cursor">.</span>';

      if (cosmicAudio.ctx && !cosmicAudio.isPlaying) cosmicAudio.start();
      cosmicAudio.playTransmissionBlip();

      await new Promise(function (r) { setTimeout(r, 2200); });

      phaseConnecting.classList.remove('active');
      phaseConnecting.classList.add('hidden');
      transmissionZone.style.display = 'flex';
      invokeEl.style.display = 'block';

      originEl.textContent = '\u27E8 signal intercepted \u27E9';
      coordsEl.textContent = generateCoords();
      setRobotAppearance(chosenRobot);

      var firstMsg = chosenRobot.messages[Math.floor(Math.random() * chosenRobot.messages.length)];
      usedMessages.push(firstMsg);
      typeMessage(firstMsg);
    }

    runFlow();

    var invokeHidden = false;
    document.addEventListener('click', function (e) {
      if (!chosenRobot) return;
      if (e.target === invokeEl || e.target === document.body || e.target.closest('.transmission-zone')) {
        newTransmission();
        if (!invokeHidden) {
          invokeHidden = true;
          invokeEl.style.opacity = '0';
          setTimeout(function () { invokeEl.style.display = 'none'; }, 500);
        }
        var particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = e.clientX + 'px';
        particle.style.top = e.clientY + 'px';
        particle.style.animation = 'fadeIn 0.3s ease forwards, hover 2s ease-out forwards';
        document.body.appendChild(particle);
        setTimeout(function () { particle.remove(); }, 2000);
      }
    });

    document.addEventListener('mousemove', function (e) {
      var x = (e.clientX - window.innerWidth / 2) / 50;
      var y = (e.clientY - window.innerHeight / 2) / 50;
      robotEl.style.transform = 'translate(' + x + 'px, ' + y + 'px)';
    });

    setInterval(function () {
      if (!chosenRobot) return; // don't flicker bars during scanning
      var bars = document.querySelectorAll('.bar');
      var activeCount = Math.floor(Math.random() * 5) + 1;
      bars.forEach(function (bar, i) { bar.classList.toggle('active', i < activeCount); });
    }, 3000);

    audioToggle.addEventListener('click', function (e) {
      e.stopPropagation();
      var isPlaying = cosmicAudio.toggle();
      audioToggle.classList.toggle('active', isPlaying);
      audioIcon.textContent = isPlaying ? '\u25C9' : '\u25CB';
      audioLabel.textContent = isPlaying ? 'sound on' : 'sound off';
    });
  </script>
</body>
</html>
